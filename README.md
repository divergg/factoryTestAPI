# factoryTestAPI
# Тестовое задание 
Разработан сервис управления рассылками API администрирования и получения статистики.
Основой используемый стэк - Django-Rest-Framework, Celery, Redis, postgresql
# **Реализованные функции**
1. Созданы сущности "Рассылка", "Клиент" и "Сообщение"
2. Реализовано API для:

    добавления нового клиента в справочник со всеми его атрибутами

    обновления данных атрибутов клиента

    удаления клиента из справочника

    добавления новой рассылки со всеми её атрибутам

    получения общей статистики по созданным рассылкам и количеству отправленных сообщений по ним с группировкой по статусам
    
    получения детальной статистики отправленных сообщений по конкретной рассылке
    
    обновления атрибутов рассылки
    
    удаления рассылки
    
    обработки активных рассылок и отправки сообщений клиентам
    
3. Реализованные основные функции:

    после  получения запроса от пользователя инициализируется рассылка по списку клиентов (если время начала раньше или равно текущему времени)
    
    если время начала рассылки позже - вне зависимости от пользователя рассылка ставится на паузу и запускается самостоятельно в нужное время
    
    осуществляется сбор статитстики и выдача ее пользователю по запросу
    
    ошибки внешнего сервиса не влияют на функционал
  
4. Реализованные дополнительные функции:

    реализовано тестирование (проверка- python manage.py test)
    
    подготовлен docker-compose
    
    по адресу /docs/ открывается страница со Swagger UI
    
    реализован администраторский Web UI
    
    организована обработка оишибок внешнего сервиса
    
    обеспечено логирование в отдельные файлы (file.log и celery.log)
    
# Схема URL проекта
http://0.0.0.0:8000/ - основная страница

http://0.0.0.0:8000/deliveries/ - рассылки

http://0.0.0.0:8000/clients/ - клиенты

http://0.0.0.0:8000/messages/ - сообщения

http://0.0.0.0:8000/deliveries/get_general_statistic - общая статистика

http://0.0.0.0:8000/deliveries/<pk>/get_detail_statistic/ - детальная статистик

http://0.0.0.0:8000/docs/ - документация

    
# Порядок запуска (требуется установленный docker)
1. Склонировать репозиторий
2. Выполнить запуск контейнеров (docker-compose up)

# Порядок запуска без docker (требуется установленная postgresql и Redis)
1. Склонировать репозиторий
2. Создать файл .env, где указать url внешнего сервиса и token (переменные URL и TOKEN)
3. Установить и активировать виртуальную среду (python venv)
4. Установить зависимости из файла requirements.txt
5. Внести изменения в файл settings.py в части используемой базы данных (при необходимости)
6. Выполнить миграции (python manage.py makemigrations и python manage.py migrate)
7. Запустить сервер python manage.py runserver
8. Запустить Celery (celery -A mailingapi worker -l info)
9. Запустить Redis

